<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hastane Alım Listesi</title>
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #34495e;
            --accent-color: #3498db;
            --bg-color: #f4f6f7;
            --fav-color: #f1c40f;
            --border-color: #ddd;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-color);
            margin: 0;
            padding: 20px;
            color: #333;
            /* Mobilde seçim yapmayı engelle, sürüklemeyi kolaylaştır */
            -webkit-touch-callout: none; 
            -webkit-user-select: none;
            user-select: none;
        }

        h1, h2 {
            text-align: center;
            color: var(--primary-color);
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
        }

        /* Tablo Tasarımı */
        .table-wrapper {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow-x: auto; 
            margin-bottom: 30px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 600px; 
            table-layout: fixed; /* Sütun genişliklerini sabitle */
        }

        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
            vertical-align: middle;
            overflow-wrap: break-word;
        }

        th {
            background-color: var(--secondary-color);
            color: white;
            cursor: pointer;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        th:hover {
            background-color: var(--primary-color);
        }

        tr { background: #fff; }
        tr:hover { background-color: #f9f9f9; }

        /* Sütun Genişlikleri */
        .col-star { width: 40px; text-align: center; font-size: 1.5rem; cursor: pointer; }
        .col-no { width: 50px; text-align: center; font-weight: bold; color: #7f8c8d; }
        .col-alim { font-weight: bold; color: #e74c3c; width: 100px; }
        .col-yatak { width: 120px; }
        
        /* Yıldız İkonu */
        .star {
            color: #ccc;
            transition: color 0.2s;
        }
        .star.active {
            color: var(--fav-color);
        }

        /* --- SÜRÜKLE BIRAK STİLLERİ (Favoriler İçin) --- */
        
        /* Sadece favoriler tablosundaki No sütunu tutulabilir olsun */
        #tbody-favorites .col-no {
            cursor: move; /* Mouse imleci */
            background-color: #fff3cd; /* Hafif sarı, tutulabilir olduğunu belli et */
            touch-action: none; /* Mobilde sayfa kaydırmayı engelle, satır kaysın */
        }

        /* Sürüklenen satırın stili */
        tr.dragging {
            background: #cce5ff !important;
            opacity: 0.8;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        /* Favoriler Bölümü */
        #favorites-container {
            margin-top: 40px;
            border-top: 2px dashed #ccc;
            padding-top: 20px;
        }
        
        #favorites-section {
            border: 2px solid var(--fav-color);
        }

        /* Mobil Uyumluluk */
        @media screen and (max-width: 768px) {
            body { padding: 10px; }
            th, td { padding: 8px 5px; font-size: 14px; }
            h1 { font-size: 20px; }
            h2 { font-size: 18px; }
            
            /* Mobilde tablo taşarsa kaydırma */
            .table-wrapper {
                -webkit-overflow-scrolling: touch;
            }
        }
    </style>
</head>
<body>

<div class="container">
    <h1>Hastane Alım & Yatak Kapasitesi</h1>

    <h2>Anadolu Yakası</h2>
    <div class="table-wrapper">
        <table id="table-anadolu">
            <thead>
                <tr>
                    <th class="col-star">Fav</th>
                    <th class="col-no">No</th>
                    <th onclick="sortData('anadolu', 'name')">Hastane Adı &#8645;</th>
                    <th class="col-yatak" onclick="sortData('anadolu', 'bedsRaw')">Yatak Sayısı &#8645;</th>
                    <th class="col-alim" onclick="sortData('anadolu', 'recruit')">Alım Sayısı &#8645;</th>
                </tr>
            </thead>
            <tbody id="tbody-anadolu"></tbody>
        </table>
    </div>

    <h2>Avrupa Yakası</h2>
    <div class="table-wrapper">
        <table id="table-avrupa">
            <thead>
                <tr>
                    <th class="col-star">Fav</th>
                    <th class="col-no">No</th>
                    <th onclick="sortData('avrupa', 'name')">Hastane Adı &#8645;</th>
                    <th class="col-yatak" onclick="sortData('avrupa', 'bedsRaw')">Yatak Sayısı &#8645;</th>
                    <th class="col-alim" onclick="sortData('avrupa', 'recruit')">Alım Sayısı &#8645;</th>
                </tr>
            </thead>
            <tbody id="tbody-avrupa"></tbody>
        </table>
    </div>

    <div id="favorites-container" style="display:none;">
        <h2 style="color: #f39c12;">Favorilerim &#9733; (Sıralamak için No'dan Tutun)</h2>
        <div class="table-wrapper" id="favorites-section">
            <table id="table-favorites">
                <thead>
                    <tr>
                        <th class="col-star">Fav</th>
                        <th class="col-no">No</th>
                        <th>Hastane Adı</th>
                        <th class="col-yatak">Yatak Sayısı</th>
                        <th class="col-alim">Alım Sayısı</th>
                    </tr>
                </thead>
                <tbody id="tbody-favorites"></tbody>
            </table>
        </div>
    </div>
</div>

<script>
    // --- VERİ SETLERİ ---
    const anadoluRaw = [
        {id: 1, name: "İstanbul Kartal Dr. Lütfi Kırdar Şehir Hastanesi", beds: "~1250", recruit: 95},
        {id: 2, name: "İstanbul Göztepe Prof. Dr. Süleyman Yalçın Şehir Hast.", beds: "~1160", recruit: 55},
        {id: 3, name: "İstanbul Ümraniye Eğitim ve Araştırma Hastanesi", beds: "~845", recruit: 65},
        {id: 4, name: "İstanbul Sancaktepe Şehit Prof. Dr. İlhan Varank EAH", beds: "~725", recruit: 95},
        {id: 5, name: "İstanbul Haydarpaşa Numune Eğitim ve Araştırma Hast.", beds: "~710", recruit: 42},
        {id: 6, name: "İstanbul Marmara Üniversitesi Pendik EAH", beds: "~650", recruit: 75},
        {id: 7, name: "İstanbul Sultan 2. Abdülhamid Han EAH", beds: "~610", recruit: 61},
        {id: 8, name: "İstanbul Dr. Siyami Ersek Göğüs Kalp ve Damar Cer. EAH", beds: "~550", recruit: 66},
        {id: 9, name: "İstanbul Süreyyapaşa Göğüs Hastalıkları ve Göğüs Cer. EAH", beds: "~500", recruit: 45},
        {id: 10, name: "İstanbul Kartal Koşuyolu Yüksek İhtisas EAH", beds: "~460", recruit: 25},
        {id: 11, name: "İstanbul Fatih Sultan Mehmet Eğitim ve Araştırma Hast.", beds: "~350", recruit: 18},
        {id: 12, name: "İstanbul Sultanbeyli Devlet Hastanesi", beds: "~250", recruit: 15},
        {id: 13, name: "İstanbul Tuzla Devlet Hastanesi", beds: "~200", recruit: 15},
        {id: 14, name: "İstanbul Kadıköy İlçe Sağlık Müdürlüğü", beds: "0 (İdari)", recruit: 1}
    ];

    const avrupaRaw = [
        {id: 1, name: "İst. Başakşehir Çam ve Sakura Şehir Hastanesi", beds: "~2.682", recruit: 200},
        {id: 2, name: "İst. Prof. Dr. Cemil Taşcıoğlu Şehir Hast. (Okmeydanı)", beds: "~1.100", recruit: 51},
        {id: 3, name: "İst. Şişli Hamidiye Etfal Eğitim ve Araştırma Hast.", beds: "~1.000", recruit: 62},
        {id: 4, name: "İst. Kanuni Sultan Süleyman Eğitim ve Araştırma Hast.", beds: "~880", recruit: 38},
        {id: 5, name: "İst. Bağcılar Eğitim ve Araştırma Hastanesi", beds: "~850", recruit: 125},
        {id: 6, name: "İst. Eğitim ve Araştırma Hastanesi (Samatya)", beds: "~750", recruit: 29},
        {id: 7, name: "İst. Bakırköy Dr. Sadi Konuk EAH", beds: "~650", recruit: 75},
        {id: 8, name: "İst. Haseki Eğitim ve Araştırma Hastanesi", beds: "~600", recruit: 52},
        {id: 9, name: "İst. Mehmet Akif Ersoy Göğüs Kalp ve Damar Cer. EAH", beds: "~560", recruit: 10},
        {id: 10, name: "İst. Gaziosmanpaşa Eğitim ve Araştırma Hastanesi", beds: "~550", recruit: 30},
        {id: 11, name: "İst. Yedikule Göğüs Hastalıkları ve Göğüs Cer. EAH", beds: "~380", recruit: 11},
        {id: 12, name: "İst. Bahçelievler Devlet Hastanesi", beds: "~340", recruit: 25},
        {id: 13, name: "İst. Beylikdüzü Devlet Hastanesi", beds: "~300", recruit: 28},
        {id: 14, name: "İst. Büyükçekmece Mimar Sinan Devlet Hastanesi", beds: "~270", recruit: 25},
        {id: 15, name: "İst. Taksim Eğitim ve Araştırma Hastanesi", beds: "~250", recruit: 10},
        {id: 16, name: "İst. Fizik Tedavi ve Rehabilitasyon EAH", beds: "~230", recruit: 5},
        {id: 17, name: "İst. Silivri Devlet Hastanesi", beds: "~210", recruit: 8},
        {id: 18, name: "İst. Arnavutköy Devlet Hastanesi", beds: "~200", recruit: 13},
        {id: 19, name: "İst. Avcılar Murat Kölük Devlet Hastanesi", beds: "~180", recruit: 15},
        {id: 20, name: "İst. Eyüpsultan Devlet Hastanesi", beds: "~150", recruit: 8},
        {id: 21, name: "İst. İstinye Devlet Hastanesi", beds: "~130", recruit: 5},
        {id: 22, name: "İst. Başakşehir Devlet Hastanesi", beds: "~100", recruit: 12},
        {id: 23, name: "İst. Çatalca İlyas Çokay Devlet Hastanesi", beds: "~75", recruit: 4}
    ];

    // Veri işleme
    function processData(data, prefix) {
        return data.map(item => {
            let cleanBeds = parseInt(item.beds.replace(/[^0-9]/g, '')) || 0;
            return {
                uniqueId: prefix + "-" + item.id,
                ...item,
                bedsClean: cleanBeds
            };
        });
    }

    let anadoluData = processData(anadoluRaw, "anadolu");
    let avrupaData = processData(avrupaRaw, "avrupa");
    let favorites = JSON.parse(localStorage.getItem('hospitalFavorites')) || [];
    let sortState = { anadolu: {key: 'recruit', asc: false}, avrupa: {key: 'recruit', asc: false} };

    // --- SÜRÜKLE BIRAK DEĞİŞKENLERİ ---
    let dragSrcEl = null;
    let touchStartY = 0;
    let touchCurrentRow = null;

    // --- TEMEL FONKSİYONLAR ---

    function saveFavorites() {
        localStorage.setItem('hospitalFavorites', JSON.stringify(favorites));
        // Kaydettikten sonra render et ki sıra numaraları (1,2,3) düzelsin
        renderAll();
    }

    // Drop işleminden sonra DOM'daki sıraya göre diziyi güncelle
    function updateFavoritesFromDOM() {
        const tbody = document.getElementById('tbody-favorites');
        const rows = Array.from(tbody.querySelectorAll('tr'));
        
        const newOrder = [];
        rows.forEach(row => {
            const uid = row.getAttribute('data-uid');
            // Mevcut verilerden bul
            let item = favorites.find(f => f.uniqueId === uid);
            if(item) newOrder.push(item);
        });

        favorites = newOrder;
        saveFavorites();
    }

    function toggleFavorite(uniqueId) {
        let item = anadoluData.find(x => x.uniqueId === uniqueId) || avrupaData.find(x => x.uniqueId === uniqueId);
        
        if (!item) item = favorites.find(x => x.uniqueId === uniqueId);
        if (!item) return;

        const index = favorites.findIndex(x => x.uniqueId === uniqueId);
        
        if (index > -1) {
            favorites.splice(index, 1);
        } else {
            favorites.push(item);
        }
        saveFavorites();
    }

    function sortData(region, key) {
        const data = region === 'anadolu' ? anadoluData : avrupaData;
        const state = sortState[region];

        if (state.key === key) {
            state.asc = !state.asc;
        } else {
            state.key = key;
            state.asc = true;
            if(key === 'recruit' || key === 'bedsClean') state.asc = false;
        }

        data.sort((a, b) => {
            let valA = key === 'bedsRaw' ? a.bedsClean : a[key];
            let valB = key === 'bedsRaw' ? b.bedsClean : b[key];

            if (typeof valA === 'string') valA = valA.toLowerCase();
            if (typeof valB === 'string') valB = valB.toLowerCase();

            if (valA < valB) return state.asc ? -1 : 1;
            if (valA > valB) return state.asc ? 1 : -1;
            return 0;
        });

        renderAll();
    }

    // --- DRAG & DROP HANDLERS (MOUSE & TOUCH) ---

    function handleDragStart(e) {
        // Sadece No sütunundan tutulursa çalışsın ama satırı taşısın
        dragSrcEl = this.closest('tr');
        e.dataTransfer.effectAllowed = 'move';
        e.dataTransfer.setData('text/html', dragSrcEl.innerHTML);
        dragSrcEl.classList.add('dragging');
    }

    function handleDragOver(e) {
        if (e.preventDefault) e.preventDefault();
        e.dataTransfer.dropEffect = 'move';
        return false;
    }

    function handleDrop(e) {
        if (e.stopPropagation) e.stopPropagation();
        
        const dropTarget = e.target.closest('tr');
        if (!dropTarget || dropTarget === dragSrcEl) return false;

        const tbody = document.getElementById('tbody-favorites');
        
        // DOM'da yer değiştir
        const rows = Array.from(tbody.children);
        const srcIndex = rows.indexOf(dragSrcEl);
        const targetIndex = rows.indexOf(dropTarget);

        if (srcIndex < targetIndex) {
            tbody.insertBefore(dragSrcEl, dropTarget.nextSibling);
        } else {
            tbody.insertBefore(dragSrcEl, dropTarget);
        }

        dragSrcEl.classList.remove('dragging');
        
        // Diziyi güncelle
        updateFavoritesFromDOM();
        return false;
    }

    function handleDragEnd() {
        if (dragSrcEl) dragSrcEl.classList.remove('dragging');
    }

    // -- MOBİL TOUCH HANDLERS --

    function handleTouchStart(e) {
        touchCurrentRow = this.closest('tr');
        touchStartY = e.touches[0].clientY;
        touchCurrentRow.classList.add('dragging');
        // e.preventDefault(); // Sayfanın kaymasını engellemek için CSS touch-action kullandık
    }

    function handleTouchMove(e) {
        if (!touchCurrentRow) return;
        
        const touchY = e.touches[0].clientY;
        const tbody = document.getElementById('tbody-favorites');
        const rows = Array.from(tbody.children);
        
        // Hangi satırın üzerindeyiz?
        rows.forEach(row => {
            if (row === touchCurrentRow) return;
            const rect = row.getBoundingClientRect();
            if (touchY > rect.top && touchY < rect.bottom) {
                if (touchY < rect.top + rect.height / 2) {
                    tbody.insertBefore(touchCurrentRow, row);
                } else {
                    tbody.insertBefore(touchCurrentRow, row.nextSibling);
                }
            }
        });
        e.preventDefault(); // Sürüklerken ekran kaymasın
    }

    function handleTouchEnd() {
        if (touchCurrentRow) {
            touchCurrentRow.classList.remove('dragging');
            touchCurrentRow = null;
            updateFavoritesFromDOM(); // Bırakınca kaydet
        }
    }

    function addDnDHandlers(cell) {
        // Mouse Events
        cell.addEventListener('dragstart', handleDragStart);
        cell.addEventListener('dragend', handleDragEnd);
        
        // Touch Events
        cell.addEventListener('touchstart', handleTouchStart, {passive: false});
        cell.addEventListener('touchmove', handleTouchMove, {passive: false});
        cell.addEventListener('touchend', handleTouchEnd);
    }


    // --- RENDER ---

    function renderTable(tbodyId, data, isFavoriteTable = false) {
        const tbody = document.getElementById(tbodyId);
        tbody.innerHTML = "";

        // Eğer favori tablosuysa drop listener ekle
        if (isFavoriteTable) {
            tbody.addEventListener('dragover', handleDragOver);
            tbody.addEventListener('drop', handleDrop);
        }

        data.forEach((row, index) => {
            const isFav = favorites.some(f => f.uniqueId === row.uniqueId);
            const tr = document.createElement('tr');
            tr.setAttribute('data-uid', row.uniqueId); // Sıralama için ID sakla

            // Favori tablosunda No sütunu sürüklenebilir
            const noCellAttr = isFavoriteTable ? 'draggable="true"' : '';
            
            tr.innerHTML = `
                <td class="col-star" onclick="toggleFavorite('${row.uniqueId}')">
                    <span class="star ${isFav ? 'active' : ''}">&#9733;</span>
                </td>
                <td class="col-no" ${noCellAttr}>${index + 1}</td>
                <td>${row.name}</td>
                <td>${row.beds}</td>
                <td class="col-alim">${row.recruit}</td>
            `;
            
            tbody.appendChild(tr);

            // Eğer favori tablosuysa No hücresine eventleri ekle
            if (isFavoriteTable) {
                const noCell = tr.querySelector('.col-no');
                addDnDHandlers(noCell);
            }
        });
    }

    function renderAll() {
        renderTable('tbody-anadolu', anadoluData);
        renderTable('tbody-avrupa', avrupaData);
        
        const favContainer = document.getElementById('favorites-container');
        if (favorites.length === 0) {
            favContainer.style.display = 'none';
        } else {
            favContainer.style.display = 'block';
            renderTable('tbody-favorites', favorites, true);
        }
    }

    // --- BAŞLANGIÇ ---
    // İlk açılışta sırala
    anadoluData.sort((a, b) => b.recruit - a.recruit);
    avrupaData.sort((a, b) => b.recruit - a.recruit);
    
    renderAll();

</script>

</body>
</html>
